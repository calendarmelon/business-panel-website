import{j as s,C as y,m as U,n as V,o as z,q as D}from"./index-BqPi6Scg.js";import{a as r,j as H}from"./vendor-CMvHcHbC.js";import{c as b,b as S}from"./index.esm-CgghJxql.js";import{u as M}from"./useLocale-C1tm0iYC.js";import{N as g}from"./navPaths-CZBFaHdh.js";import{d as p,b as i,c as d,a as j}from"./CRow-D_28WzSY.js";import{c as k,d as v,b as w,a as _}from"./CForm-CHhLrB3s.js";import{C as T}from"./CInputGroup-Dx0YLWSn.js";import{C as F}from"./CInputGroupText-D8xN2KBJ.js";import{c as E}from"./cil-lock-locked-DmxpJbVL.js";import"./redux-IAqEd8mO.js";const rs=()=>{const[n,L]=r.useState(""),[m,q]=r.useState(""),[l,c]=r.useState(!1),[h,a]=r.useState(""),[P,f]=r.useState(!1),[R,u]=r.useState(!1),[I,A]=r.useState(!0),x=H(),{t:e}=M();console.log("[todo ResetPassword]"),r.useEffect(()=>{(async()=>{try{const{session:o,error:G}=await U();console.log("[todo setSessionFromUrl]",{urlSession:o,urlError:G});const{session:C,error:N}=await V();console.log("[todo checkSession]",{session:C,error:N}),N||!C?(u(!1),a(e("resetPasswordPage.errors.invalidToken"))):u(!0)}catch{u(!1),a(e("resetPasswordPage.errors.invalidToken"))}finally{A(!1)}})()},[e]);const B=async t=>{if(t.preventDefault(),c(!0),a(""),f(!1),!n||!m){a(e("resetPasswordPage.errors.allFieldsRequired")),c(!1);return}if(n.length<8){a(e("resetPasswordPage.errors.passwordTooShort")),c(!1);return}if(n!==m){a(e("resetPasswordPage.errors.passwordMismatch")),c(!1);return}try{const{error:o}=await z(n);if(o)throw new Error(o);f(!0),setTimeout(async()=>{await D(),x(g.login)},3e3)}catch(o){a(o.message||e("resetPasswordPage.errors.updateFailed"))}finally{c(!1)}};return I?s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(p,{children:s.jsx(i,{className:"justify-content-center",children:s.jsxs(d,{md:6,className:"text-center",children:[s.jsx(y,{color:"primary"}),s.jsx("p",{className:"mt-3",children:e("resetPasswordPage.validating")})]})})})}):R?s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(p,{children:s.jsx(i,{className:"justify-content-center",children:s.jsx(d,{md:6,children:s.jsx(k,{className:"p-4",children:s.jsx(v,{children:s.jsxs(_,{onSubmit:B,children:[s.jsx("h1",{children:e("resetPasswordPage.title")}),s.jsx("p",{className:"text-body-secondary",children:e("resetPasswordPage.description")}),h&&s.jsx(w,{color:"danger",className:"mb-3",children:h}),P&&s.jsxs(w,{color:"success",className:"mb-3",children:[s.jsx("strong",{children:e("resetPasswordPage.success.title")}),s.jsx("p",{className:"mb-0 mt-2",children:e("resetPasswordPage.success.description")})]}),!P&&s.jsxs(s.Fragment,{children:[s.jsxs(T,{className:"mb-3",children:[s.jsx(F,{children:s.jsx(b,{icon:E})}),s.jsx(S,{type:"password",placeholder:e("resetPasswordPage.placeholders.newPassword"),autoComplete:"new-password",value:n,onChange:t=>L(t.target.value),required:!0,disabled:l})]}),s.jsxs(T,{className:"mb-4",children:[s.jsx(F,{children:s.jsx(b,{icon:E})}),s.jsx(S,{type:"password",placeholder:e("resetPasswordPage.placeholders.confirmPassword"),autoComplete:"new-password",value:m,onChange:t=>q(t.target.value),required:!0,disabled:l})]}),s.jsx(i,{children:s.jsx(d,{xs:12,children:s.jsx(j,{type:"submit",color:"primary",className:"px-4",disabled:l,children:l?s.jsxs(s.Fragment,{children:[s.jsx(y,{size:"sm",className:"me-2"}),e("resetPasswordPage.updating")]}):e("resetPasswordPage.resetPassword")})})})]}),s.jsx(i,{className:"mt-3",children:s.jsx(d,{xs:12,children:s.jsx(j,{color:"link",className:"px-0",onClick:()=>x(g.login),disabled:l,children:e("resetPasswordPage.backToLogin")})})})]})})})})})})}):s.jsx("div",{className:"bg-body-tertiary min-vh-100 d-flex flex-row align-items-center",children:s.jsx(p,{children:s.jsx(i,{className:"justify-content-center",children:s.jsx(d,{md:6,children:s.jsx(k,{className:"p-4",children:s.jsxs(v,{children:[s.jsx("h1",{children:e("resetPasswordPage.title")}),s.jsx(w,{color:"danger",className:"mt-3",children:h||e("resetPasswordPage.errors.invalidToken")}),s.jsx(j,{color:"primary",className:"mt-3",onClick:()=>x(g.forgotPassword),children:e("resetPasswordPage.requestNewLink")})]})})})})})})};export{rs as default};
